<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/Rate.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/Rate.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable func-names */
/* eslint-disable quote-props */

/**
 * @author Jaka Daneu
 * @fileoverview Defines mongoose {@link module:models/Rate~Rate Rate model} based on
 * {@link module:models/Rate~Rate.RateSchema Rate Schema}.
 * &lt;p>{@link module:models/Rate Rate} module exports
 * {@link module:models/Rate~Rate Rate Model}&lt;/p>
 * @requires {@link https://www.npmjs.com/package/mongoose module:NPM:mongoose}
 * @requires config/logger.addLogger
 * @see {@link module:models/Rate Rate module}
 * @see {@link module:models/Rate~Rate Rate Model}
 * @see {@link module:models/Rate~Rate.RateSchema Rate Schema}
 * &lt;p>&lt;/p>
 * @see {@link https://mongoosejs.com/docs/models.html mongoose Models}
 * @see {@link https://mongoosejs.com/docs/guide.html mongoose Schemas}
 */

/**
  * Defines mongoose {@link module:models/Rate~Rate Rate Model} based on
  * {@link module:models/Rate~Rate.RateSchema Rate Schema}.
  * &lt;p>{@link module:models/Rate Rate} module exports
  * {@link module:models/Rate~Rate Rate Model}.&lt;/p>
  * @module
  * @example
  * const rateObject = {
  *   success: true,
  *   timestamp: Number,
  *   base: EUR,
  *   date: new Date('2019-11-7'),
  *   rates: [{USA: 1.12}, {HRK: 7.53}, [...]
  * };
  * rate = new Rate(rateObject);
  * rate.save();
  * }
  * @see {@link module:models/Rate~Rate Rate Model}
  * @see {@link module:models/Rate~Rate.RateSchema Rate Schema}
  * &lt;p>&lt;/p>
  * @see {@link module:utils/getRates getRates()}
  * &lt;p>&lt;/p>
  * @see {@link https://mongoosejs.com/docs/models.html mongoose Models}
  * @see {@link https://mongoosejs.com/docs/guide.html mongoose Schemas}
  */

/** mongoose */
const mongoose = require('mongoose');
/** addLogger */
const { addLogger } = require('../config/logger');

const pathDepth = module.paths.length - 6;
const Logger = addLogger(__filename, pathDepth);

/**
 * @description Represents Rate mongoose document.
 * &lt;p>Actual object for creating new mongoose Schema has more complex definition. See source!&lt;/p>
 * This object is based on {@link https://fixer.io/documentation#apiresponse Fixer Api} response.
 * Mongoose {@link https://mongoosejs.com/docs/validation.html#validation Validation} is based on this object.
 *
 * @type {Object}
 * @memberof module:models/Rate~Rate
 * @property {Boolean} success whether was response successful
 * @property {Number} timestamp when was response created
 * @property {String} base base currency
 * @property {Date} date date for rates
 * @property {Object} rates rates
 */
const rateSchemaObject = {
  success: Boolean,
  timestamp: Number,
  base: String,
  date: Date,
  rates: Object
};

/**
 * @type {mongoose.Schema}
 * @description new mongoose.Schema(rateSchemaObject, {timestamps: true})
 * @memberof module:models/Rate~Rate
 * @param {rateschemaObject} rateSchemaObject
 * {@link module:models/Rate~Rate.rateSchemaObject rateSchemaObject}
 * @param {mongooseSchemaOptions} options {@link https://mongoosejs.com/docs/guide.html#options Schema Options}
 *
 * &lt;p>&lt;/p>
 * @see {@link module:models/Rate~Rate Rate model}
 * @see {@link module:models/Rate~Rate.rateSchemaObject rateSchemaObject}
 * @see {@link module:utils/getRates getRates()}
 * &lt;p>&lt;/p>
 * @see {@link https://mongoosejs.com/docs/models.html mongoose Models}
 * @see {@link https://mongoosejs.com/docs/guide.html mongoose Schemas}
 */
const RateSchema = new mongoose.Schema(
  rateSchemaObject,
  { timestamps: true }
);

/**
 *
 * @description It finds Rate documents in travel document date range.
 * &lt;p>&lt;/p>
 * It is Rate &lt;b>model&lt;/b> static function.
 * &lt;p>&lt;/p>
 * It has to be unnamed function! Otherwise we have to use bind.
 * @function findRatesOnDate
 * @memberof module:models/Rate~Rate
 * @this module:models/Rate~Rate.RateSchema
 * @param {Travel} travel travel document for which we want to find
 * @returns Array with partial (date and rates properties)
 * Rate document objects where date is in travel dates range.
 *
 */
RateSchema.statics.findRatesOnDate = function(travel) {
  Logger.debug('findRatesOnDate');
  return this.find({
    $and: [
      { date: { $gte: travel.dateFrom } }, { date: { $lte: travel.dateTo } }
    ]
  }, (err, doc) => {
    if (err) {
      Logger.error(err.message);
    } else {
      Logger.debug(`Find rates for date range from ${travel.dateFrom} to ${travel.dateTo}.`);
      Logger.debug(`Find rates for ${doc.length} day(s)`);
    }
  }).select({ 'rates': 1, 'date': 1, '_id': 0 });
};


/**
 *
 * @description It finds document closest to travel document date range.
 * &lt;p>&lt;/p>
 * It is Rate &lt;b>model&lt;/b> static function.
 * &lt;p>&lt;/p>
 * It has to be unnamed function! Otherwise we have to use bind.
 * @function findRateBeforeOrAfterDate
 * @memberof module:models/Rate~Rate
 * @this module:models/Rate~Rate.RateSchema
 * @param {Travel} travel
 * @returns Array with one partial (date and rate property)
 * Rate document where date is closest to travel dates.
 *
 */
RateSchema.statics.findRateBeforeOrAfterDate = function (travel) {
  Logger.debug('findRateBeforeOrAfterDate');
  return this.find({
    $or: [{ date: { $gte: travel.dateFrom } }, { date: { $lte: travel.dateFrom } }]
  }, (err, doc) => {
    if (err) {
      Logger.error(err.message);
    } else {
      Logger.debug(`Find rates for date range from ${travel.dateFrom} to ${travel.dateTo}.`);
      Logger.debug(`Find rates for ${doc.length} day(s)`);
    }
  })
    .sort({ 'date': 1 })
    .limit(1)
    .select({ 'rates': 1, 'date': 1, '_id': 0 },);
};


/**
 * &lt;i>&lt;u>rateObject&lt;/u>&lt;/i> has 5 properties:
 * &lt;p>&lt;b>success&lt;/b> - whether the response was successful&lt;/p>
 * &lt;p>&lt;b>timestamp&lt;/b> - when was response retrived&lt;/p>
 * &lt;p>&lt;b>base&lt;/b> - for which currency are rates&lt;/p>
 * &lt;p>&lt;b>date&lt;/b> - for which date are rates&lt;/p>
 * &lt;p>&lt;b>rates&lt;/b> - rates as object with key as currency code and value as rate value&lt;/p>
 * &lt;i>Mongoose new mongoose.Schema({...}, options) creates additional properties&lt;/i>:
 * &lt;b>_id&lt;/b>, &lt;b>__v&lt;/b>, &lt;b>createdAt&lt;/b> and &lt;b>updatedAt&lt;/b>, first two by default,
 * second two when passing {timesatmps: true} as second argument.
 * &lt;br>&lt;/br>
 * It's mongoose {@link https://mongoosejs.com/docs/models.html model} and
 * the instance is called {@link https://mongoosejs.com/docs/documents.html document}.
 * &lt;p>&lt;/p>
 * Models are fancy constructors compiled from Schema definitions.
 * An instance of a model is called a document.
 * Models are responsible for creating and reading documents from the underlying MongoDB database.
 * &lt;p>&lt;/p>
 * {@link https://mongoosejs.com/docs/validation.html#validation Validation} is based on
 * {@link module:models/Rate~Rate.rateSchemaObject rateSchemaObject}.
 *
 * @constructor Rate
 * @classdesc
 * Application uses this constructor only when retrieving data from
 * {@link https://fixer.io/documentation#apiresponse Fixer Api}.
 * See {@link module:utils/getRates getRates()}
 * @param {ratesObject} [ratesObject={}] {@link module:models/Rate~Rate.rateSchemaObject rateObject}
 * @returns Rate document when using with new.
 * @example
 * const rateObject = {
 *   success: true
 *   timestamp: Number,
 *   base: EUR,
 *   date: new Date('2019-11-7'),
 *   rates: [{USA: 1.12}, {HRK: 7.53}, [...]
 * };
 * rate = new Rate(rateObject);
 * rate.save();
}
 * @see {@link module:models/Rate~Rate.RateSchema RateSchema}
 * @see {@link module:models/Rate~Rate.rateSchemaObject rateSchemaObject}
 * @see {@link module:utils/getRates getRates()}
 * &lt;p>&lt;/p>
 * @see {@link https://mongoosejs.com/docs/models.html mongoose Models}
 * @see {@link https://mongoosejs.com/docs/guide.html mongoose Schemas}
 */
const Rate = mongoose.model('Rate', RateSchema);

/**
 * Expense model
 * @type {Model&lt;Document, {}>}
 */
module.exports = Rate;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-config_index.html">config/index</a></li><li><a href="module-models_Currency.html">models/Currency</a></li><li><a href="module-models_Expense.html">models/Expense</a></li><li><a href="module-models_Rate.html">models/Rate</a></li><li><a href="module-models_Travel.html">models/Travel</a></li><li><a href="module-models_User.html">models/User</a></li><li><a href="module-utils_getRates.html">utils/getRates</a></li><li><a href="module-utils_hbsHelpers.html">utils/hbsHelpers</a></li><li><a href="module-utils_myErrors.html">utils/myErrors</a></li><li><a href="module-utils_postImport.html">utils/postImport</a></li><li><a href="module-utils_travelExpensesToPDF.html">utils/travelExpensesToPDF</a></li><li><a href="module-utils_travelsTotalToPDF.html">utils/travelsTotalToPDF</a></li><li><a href="module-utils_updateExpensesToMatchTravelRangeDates.html">utils/updateExpensesToMatchTravelRangeDates</a></li><li><a href="module-utils_utils.html">utils/utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-models_Currency-Currency.html">Currency</a></li><li><a href="module-models_Expense-Expense.html">Expense</a></li><li><a href="module-models_Rate-Rate.html">Rate</a></li><li><a href="module-models_Travel-Travel.html">Travel</a></li><li><a href="module-models_User-User.html">User</a></li><li><a href="module-utils_myErrors-ImportFileError.html">ImportFileError</a></li><li><a href="module-utils_myErrors-SaveToDbError.html">SaveToDbError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#deleteExpense">deleteExpense</a></li><li><a href="global.html#getAccount">getAccount</a></li><li><a href="global.html#getContact">getContact</a></li><li><a href="global.html#getExpense">getExpense</a></li><li><a href="global.html#getForgot">getForgot</a></li><li><a href="global.html#getImport">getImport</a></li><li><a href="global.html#getLogin">getLogin</a></li><li><a href="global.html#getOauthUnlink">getOauthUnlink</a></li><li><a href="global.html#getReset">getReset</a></li><li><a href="global.html#getSignup">getSignup</a></li><li><a href="global.html#getTravel">getTravel</a></li><li><a href="global.html#index">index</a></li><li><a href="global.html#isAuthenticated">isAuthenticated</a></li><li><a href="global.html#isAuthorized">isAuthorized</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#postContact">postContact</a></li><li><a href="global.html#postDeleteAccount">postDeleteAccount</a></li><li><a href="global.html#postForgot">postForgot</a></li><li><a href="global.html#postImport">postImport</a></li><li><a href="global.html#postLogin">postLogin</a></li><li><a href="global.html#postNewExpense">postNewExpense</a></li><li><a href="global.html#postReset">postReset</a></li><li><a href="global.html#postSignup">postSignup</a></li><li><a href="global.html#postUpdatePassword">postUpdatePassword</a></li><li><a href="global.html#postUpdateProfile">postUpdateProfile</a></li><li><a href="global.html#updateExpense">updateExpense</a></li><li><a href="global.html#updateTravel">updateTravel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Dec 08 2019 12:43:45 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
